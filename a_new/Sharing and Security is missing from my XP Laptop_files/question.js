var vote=function(){var k={informModerator:-1,undoMod:0,acceptedByOwner:1,upMod:2,downMod:3,offensive:4,favorite:5,close:6,reopen:7,deletion:10,undeletion:11,spam:12};var f=imagePath+"vote-arrow-down.png";var c=imagePath+"vote-arrow-down-on.png";var x=imagePath+"vote-arrow-up.png";var w=imagePath+"vote-arrow-up-on.png";var A=imagePath+"vote-favorite-on.png";var o=imagePath+"vote-favorite-off.png";var l=function(){var C='<a href="/users/login?returnurl='+escape(document.location)+'">login or register</a>';$("div.vote").find("img").not(".vote-accepted").unbind("click").click(function(){u($(this),"Please "+C+" to use voting.")});z().unbind("click").click(function(){u($(this),"Please "+C+" to flag this post.")})};var B=function(C){if(!C){C="div.vote"}$(C).find("img.vote-up").unbind("click").click(function(){vote.up($(this))});$(C).find("img.vote-down").unbind("click").click(function(){vote.down($(this))});$(C).find("img.vote-favorite").unbind("click").click(function(){vote.favorite($(this))})};var i=function(C){C.parent().find("img").not(".vote-accepted").unbind("click")};var d=function(C){$.ajax({type:"GET",url:"/posts/"+C+"/votes",dataType:"json",success:v,cache:false})};var v=function(C){$.each(C,function(){var D=$("div.vote:has(input[value="+this.PostId+"])");switch(this.VoteTypeId){case k.upMod:D.find("img.vote-up").attr("src",w);break;case k.downMod:D.find("img.vote-down").attr("src",c);break;case k.favorite:D.find("img.vote-favorite").attr("src",A);D.find("div.favoritecount b").addClass("favoritecount-selected");break;default:alert("site.vote.js > highlightExistingVotes has no case for "+this.VoteTypeId);break}});votesCast=null};var r=function(){return $("div.vote img[id^='vote-accepted-']")};var e=function(){return $("div.post-menu a[id^='lock-post-']")};var z=function(){return $("div.post-menu a[id^='flag-post-']")};var n=function(){var C=new Image();C.src=w;C=new Image();C.src=c};var m=function(C){return C.attr("src")==w};var q=function(C){return C.attr("src")==A};var a=function(C){return C.attr("src")==c};var h=function(C){return C.parent().find("input").val()};var y=function(D,C){if(m(D)){D.attr("src",x)}if(a(C)){C.attr("src",f)}};var s=function(C,D){var E=C.siblings("span.vote-count-post");E.text(parseInt(E.text(),10)+D)};var t=function(E,D){i(E);var C=h(E);p(E,C,D,b)};var p=function(F,D,C,I,H){var G={fkey:fkey};if(H){for(var E in H){G[E]=H[E]}}$.ajax({type:"POST",url:"/posts/"+D+"/vote/"+C,data:G,dataType:"json",success:function(J){I(F,D,J)},error:function(){u(F,"An error has occurred - please retry your request.")}})};var b=function(D,C,E){if(E.Success){if(E.Message){g(D,E.Message)}}else{if(window.console&&window.console.firebug&&(!E.Message||E.Message.length<5)){u(D,"FireBug seems to be enabled, which can sometimes interfere with voting;<br>please refresh the page to see if your vote was processed.<br><br>If this persists, consider disabling FireBug for this site.")}else{u(D,E.Message);y(D,D);D.parent().find("span.vote-count-post").text(E.NewScore);if(E.LastVoteTypeId){j(D,E.LastVoteTypeId)}}}B(D.parent())};var j=function(F,D){var E,C;if(D==k.upMod){E="img.vote-up";C=w}else{if(D==k.downMod){E="img.vote-down";C=c}}if(E){F.parent().find(E).attr("src",C)}};var u=function(C,D){var E=$('<div class="error-notification supernovabg"><h2>'+D+"</h2>(click on this box to dismiss)</div>");E.click(function(F){$(".error-notification").fadeOut("fast",function(){$(this).remove()})});C.parent().append(E);E.fadeIn("fast")};var g=function(D,F){var G=$('<div class="error-notification supernovabg"><h2>'+F+"</h2></div>");D.parent().append(G);G.fadeIn("fast");var C=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var E=Math.max(2500,F.length*40);setTimeout(C,E)};return{init:function(C){if(typeof isRegistered!="undefined"&&isRegistered){n();if(votesCast==null){d(C)}else{v(votesCast)}B();z().unbind("click").click(function(){vote.flag($(this))})}else{l()}r().unbind("click").click(function(){vote.acceptedAnswer($(this))});var D=$("div.post-menu a[id^='close-question-']");D.unbind("click").click(function(){vote.close(D)});$("div.post-menu a[id^='delete-post-']").unbind("click").click(function(){vote.deletion($(this))})},up:function(F){var G=F.parent().find("img.vote-up");var E=F.parent().find("img.vote-down");var D=m(G);var C=a(E);var H=D?-1:(C?2:1);s(F,H);y(G,E);if(!D){G.attr("src",w)}t(F,D?k.undoMod:k.upMod)},down:function(F){var G=F.parent().find("img.vote-up");var E=F.parent().find("img.vote-down");var D=a(E);var C=m(G);var H=D?1:(C?-2:-1);s(F,H);y(G,E);if(!D){E.attr("src",c)}t(F,D?k.undoMod:k.downMod)},favorite:function(D){var E=D.parent().find("div.favoritecount b");var C=parseInt("0"+E.text().replace(/^\s+|\s+$/g,""),10);if(!q(D)){D.attr("src",A);E.addClass("favoritecount-selected").text(++C)}else{D.attr("src",o);E.removeClass("favoritecount-selected").text((C--<=0)?"":C)}D.unbind("click");p(D,h(D),k.favorite,function(F){D.click(function(){vote.favorite($(this))})})},acceptedAnswer:function(D){if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){var E=($("#"+C+"-is-owned-by-question-owner").length>0)?"Are you sure you want to accept your own answer?  You will STILL LOSE the offered rep and THIS CANNOT BE UNDONE!":"Are you sure you want to accept this answer to your bounty question - THIS CANNOT BE UNDONE!";if(!confirm(E)){return}}if(typeof isBountyQuestion!="undefined"&&isBountyQuestion&&typeof hasOpenBounty=="undefined"){u(D,"You cannot change the accepted answer on a bounty question");return}r().unbind("click");var C=D.attr("id").substring("vote-accepted-".length);p(D,C,k.acceptedByOwner,function(I,G,K){if(K.Message.indexOf(imagePath)>-1){var H="comments-link";var J="comments-container";$("div.answer").removeClass("accepted-answer");$("img.vote-accepted").attr("src",imagePath+"vote-accepted.png");$("a.comments-link-accepted").removeClass().addClass(H);$("div.comments-container-accepted").removeClass().addClass(J);var F=function(L){L.find(".comments-link").removeClass().addClass("comments-link-owner").end().find(".comments-container").removeClass().addClass("comments-container-owner")};$("div.answer:has(input[id$='-is-owned-by-question-owner'])").not(".owner-answer").addClass("owner-answer").each(function(){F($(this))});if(K.Message==imagePath+"vote-accepted-on.png"){$("div.answer:has(img[id^='vote-accepted-"+G+"'])").removeClass("owner-answer").addClass("accepted-answer");H=H+"-accepted";J=J+"-accepted"}else{if($("#"+G+"-is-owned-by-question-owner").length>0){F($("#answer-"+G))}}$("a[id='comments-link-"+G+"']").removeClass().addClass(H).siblings("div").removeClass().addClass(J);I.attr("src",K.Message);if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){hasOpenBounty=false;$("#bounty-notification").hide()}}else{u(I,K.Message)}r().click(function(){vote.acceptedAnswer($(this))})})},flag:function(E){var C=E.attr("id").substring("flag-post-".length);var J="form-flag-"+C;var M=$("#"+C+"-is-owned-by-current-user").length>0;var K=[[k.offensive,"Offensive, Abusive, or Hate Speech",!M],[k.spam,"Spam",!M],[k.informModerator,"Requires Moderator attention",true]];var H='<div class="popup flag-menu"><h2>Please flag with care:</h2>';H+='<div class="flag-reasons"><form id="'+J+'">';for(var F=0;F<K.length;F++){if(K[F][2]){var L="flag-radio"+C+"-"+K[F][0];H+='<input type="radio" id="'+L+'" name="flag-'+C+'" value="'+K[F][0]+'">';H+='<label for="'+L+'">'+K[F][1]+"</label><br>"}}H+='<div class="flag-comment">Why are you flagging this post?<textarea name="flag-reason" cols="33" rows="4"></textarea>';H+='<br><span class="text-counter"></span></div>';H+="</form></div>";H+='<input type="button" class="flag-cancel" value="Cancel"><input type="button" class="flag-submit" value="Flag Post">';H+="</div>";var G=$(H);var D=G.find("#"+J);var I=D.find("textarea");D.find("input").click(function(){var N=D.find("div.flag-comment");var O=vote.flagIsInform(D);N.toggle(O);if(O){I.focus()}vote.flagAllowSubmit(G,I,O)});I.bind("blur focus keyup",function(){comments.updateTextCounter(this,150);vote.flagAllowSubmit(G,I,vote.flagIsInform(D))});G.find(".flag-submit").click(function(){if(vote.flagIsInform(D)&&!vote.flagTextValid(I)){return}vote.flagSubmit(E,C,D,I)});G.find(".flag-cancel").click(function(){vote.flagClosePopup(E)});E.parent().append(G);G.fadeIn("fast")},flagIsInform:function(C){var D=C.find("input:radio:checked");if(D.length==0){return false}return D.val()==k.informModerator},flagAllowSubmit:function(D,E,F){var C=F?vote.flagTextValid(E):true;D.find(".flag-submit").toggle(C)},flagTextValid:function(D){var C=D.val().length;return(C>=10&&C<=150)},flagClosePopup:function(C){C.parent().find(".popup").fadeOut("fast",function(){$(this).remove()})},flagSubmit:function(F,D,C,G){vote.flagClosePopup(F);var E=C.find("input:radio:checked").val();var D=F.attr("id").substring("flag-post-".length);if(E==k.informModerator){$.ajax({type:"POST",url:"/messages/inform-moderator-about-post/"+D,dataType:"json",data:{fkey:fkey,msg:G.val()},success:function(H){showAjaxError(F.parent(),H.Message)},error:function(H,J,I){showAjaxError(F.parent(),(H.responseText&&H.responseText.length<100?H.responseText:"An error occurred during submission"))}})}else{p(F,D,E,vote.flagSubmitCallback,{comment:G.val()})}},flagSubmitCallback:function(D,C,F){if(F&&F.Success){if(F.Message){}}else{var E=D.parent();if(F&&F.Message){showAjaxError(E,F.Message)}else{showAjaxError(E,"A problem occurred during flagging")}}},close:function(D){var E=D.text().indexOf("open")>-1;var C=D.attr("id").substring("close-question-".length);if(E){if(confirm("Nominate this question for reopening?")){p(D,C,k.reopen,vote.close_result)}}else{if(!vote.close_reasons){vote.close_fetchReasons(D,C)}else{vote.close_renderForm(D)}}},close_reasons:null,close_fetchReasons:function(D,C){$(".error-notification").fadeOutAndRemove();appendLoader(D);$.ajax({type:"GET",url:"/posts/close-reasons/"+C,dataType:"json",success:function(E){removeLoader();vote.close_reasons=E;vote.close_renderForm(D)},error:function(E,G,F){removeLoader();showAjaxError(D.parent(),(E.responseText&&E.responseText.length<100?E.responseText:"An error occurred while fetching close reasons"))}})},close_renderForm:function(F){var D=F.attr("id").substring("close-question-".length);var C="close-popup-"+D;var K="form-close-"+D;$("#"+C).remove();var I='<div id="'+C+'" class="popup" style="width:310px"><h2>Why should this question be closed?</h2><ul class="close-reasons">';for(var G=0;G<vote.close_reasons.length;G++){var J=vote.close_reasons[G];var E="close-reason-"+J.id;I+='<li><input type="radio" id="'+E+'" name="close-'+D+'" value="'+J.id+'"><label for="'+E+'"'+(J.description?' title="'+J.description+'"':"")+">"+J.name+""+(J.count>0?' <span title="this many votes already exist">('+J.count+")</span>":"")+"</label></li>"}I+='</ul><input type="button" class="close-cancel" value="Cancel"><input type="button" class="close-submit" value="Vote to Close">';I+="</div>";var H=$(I);H.find('input[type="radio"]').click(function(){H.find(".close-submit").show()});H.find(".close-submit").click(function(){vote.close_reasonClick(F,H,D)});H.find(".close-cancel").click(function(){H.fadeOutAndRemove()});F.parent().append(H);H.fadeIn("fast")},close_reasonExactDuplicateId:1,close_hasLinkedDuplicateQuestions:false,close_reasonClick:function(D,E,C){var F=E.find('input[type="radio"]:checked').val();if(F==vote.close_reasonExactDuplicateId){vote.close_duplicateForm(D,E,C)}else{E.fadeOutAndRemove();appendLoader(D);p(D,C,k.close,vote.close_result,{"close-reason-id":F})}},close_duplicateForm:function(F,G,D){G.find("h2, ul, .close-submit").remove();G.css("width","490px");var H="duplicate-question-"+D;var E='<div style="padding-bottom:18px"><h2>This question is a duplicate of which other question?</h2><input id="'+H+'" type="text" size="78"><br><span class="close-duplicate-prompt">Type a question id or title to search for valid targets</span><div class="existing-linked-questions"></div></div><input type="button" class="close-submit" value="Vote to Close">';var C=$(E);C.find("#"+H).autocomplete("/search/duplicate-questions/"+D,{highlightItem:true,matchContains:true,matchSubset:false,scroll:true,scrollHeight:300,formatItem:function(I){G.find("a.close-submit").hide();var K=I[0];var J=I[1];return(K=="-1")?('<b style="color:#990000">'+J+"</b>"):(K+" - "+J)},formatResult:function(I){var J=I[0];return(J=="-1")?" ":J}}).result(function(J,I){G.find(".close-submit").toggle((I&&I[0]!="-1"))});G.prepend(C);vote.close_showExistingDuplicates(G,D);G.find("#"+H).focus();G.find(".close-submit").click(function(){G.fadeOutAndRemove();p(F,D,k.close,vote.close_result,{"close-reason-id":vote.close_reasonExactDuplicateId,"duplicate-question-id":$("#"+H).val()})})},close_showExistingDuplicates:function(H,C){var G=false;for(var E=0;E<vote.close_reasons.length;E++){var F=vote.close_reasons[E];if(F.id==vote.close_reasonExactDuplicateId){if(F.count>0){G=true}break}}if(!G){return}var D=H.find("div.existing-linked-questions");appendLoader(D);D.append("<p>Other users chose these questions as the master question:</p>");$.getJSON("/posts/existing-close-duplicate-questions/"+C,function(J){removeLoader();for(var I=0;I<J.length;I++){D.append('<li><a href="'+J[I].url+'" target="_blank">'+J[I].title+"</a></li>")}})},close_result:function(D,C,F){removeLoader();if(F&&F.Success){if(F.Message){var G=D.text().indexOf("open")>-1;D.text(D.text().replace(/\w?\(\d\)/,"")+" "+F.Message);u(D,"This question still needs "+F.NewScore+" vote(s) from other users to "+(G?"reopen":"close"))}else{location.reload(true)}vote.close_reasons=null}else{var E=D.parent();if(F&&F.Message){showAjaxError(E,F.Message)}else{showAjaxError(E,"A problem occurred during closing/reopening")}}},deletion:function(E){var C=E.attr("id").substring("delete-post-".length);var D=E.text().indexOf("undelete")>-1;if(confirm("Vote to "+(D?"un":"")+"delete this post?")){p(E,C,(D?k.undeletion:k.deletion),vote.deletionCallback)}},deletionCallback:function(F,E,G){var H=F.text().indexOf("undelete")>-1;if(G&&G.Success){F.text(G.Message);if(G.NewScore<0){var D=$("#question:has(a[id='delete-post-"+E+"'])").length>0;var C=D?"#question, div.answer":"#answer-"+E;vote.setDeleteStyles($(C),!H)}else{u(F,"This post still needs "+G.NewScore+" vote(s) from other users to "+(H?"un":"")+"delete")}}else{var I=(G&&G.Message)?G.Message:"A problem occurred during "+(H?"un":"")+"deletion";showAjaxError(F.parent(),I)}},setDeleteStyles:function(D,C){if(C){$("div.question-status:has(span:contains('delete'))").show();D.addClass("deleted-answer").find("a[id^='delete-post-']").addClass("deleted-post").end().find("div[id^='comments-']").addClass("comments-container-deleted").end().find("a[id^='comments-link-']").addClass("comments-link-deleted")}else{document.location.reload(true)}},bountyStart:function(D){var C=$("#question div.vote input:first").val();$.post("/posts/"+C+"/bounty-start",{fkey:fkey,amount:D},function(E){if(E.Success){location.reload(true)}else{u($("#bounty-errors"),E.Message);$("#bounty-submit").attr("disabled","")}},"json")}}}();var comments=function(){var l=imagePath+"comment-flag.png";var f=imagePath+"comment-flag-hover.png";var c=imagePath+"comment-up.png";var m=imagePath+"comment-up-hover.png";var e=imagePath+"comment-del.png";var i=imagePath+"comment-del-hover.png";var q=600;var b=function(r){return $("#comments-"+r)};var o=function(r){appendLoader("#comments-"+r+" div.comments")};var j=function(s,v){var r=$("#form-comments-"+s);if(r.length>0){var u='<table><tr><td><textarea name="comment" cols="68" rows="3" maxlength="'+q;u+='" onblur="comments.updateTextCounter(this)" ';u+='onfocus="comments.updateTextCounter(this)" onkeyup="comments.updateTextCounter(this)"></textarea>';u+='<input type="submit" value="Add Comment" /></td></tr><tr><td><span class="text-counter"></span>';u+='<span class="form-error"></span></td></tr></table>';r.append(u);r.submit(function(){var w=true;var x=function(y){w=y};bindLengthValidation(r.find("textarea"),15,"* required - at least 15 characters",r.find(".form-error"),x);if(w){disableSubmitButton(r);g(s,r)}return false});var t=$("#comments-"+s+" tr.comment:first td.comment-actions").width()||-1;t+=9;r.children("table").css("margin-left",t+"px")}};var h=function(r,s){o(r);$.ajax({type:"GET",url:"/posts/"+r+"/comments",dataType:"html",success:function(t){a(r,t)},error:function(t,v,u){removeLoader();showAjaxError("#comments-"+r,(t.responseText&&t.responseText.length<100?t.responseText:"An error has occured while fetching comments"))}})};var a=function(r,s){var t=b(r).find("div.comments");if(t.children().length>0){t.children().remove()}t.append(s);n();p();removeLoader()};var d=function(t){var r="";if(t&&t>0){var s=t<5?"":t<=15?"warm":t<=30?"hot":"supernova";r+='<span title="number of \'great comment\' votes received" class="'+s+'">'+t+"</span>"}return r};var p=function(){$("img.comment-up").click(function(){k($(this),2,c,m,function(s,r){s.closest("tr").siblings("tr").remove();s.parent().siblings().children().remove();s.parent().siblings().append(d(r.NewScore))})}).hover(function(){$(this).attr("src",m)},function(){$(this).attr("src",c)});$("img.comment-flag").click(function(){if(confirm("Really flag this comment as noise, offensive or spam?")){k($(this),4,l,f,function(s,r){if(r.NewScore==-1){s.parents("tr.comment").remove()}else{s.parents("tr.comment").find("img.comment-up").remove();s.remove()}})}}).hover(function(){$(this).attr("src",f)},function(){$(this).attr("src",l)});$("img.comment-delete").click(function(){if(confirm("Really delete this comment?")){k($(this),10,e,i,function(s,r){s.parents("tr.comment").remove()})}}).hover(function(){$(this).attr("src",i)},function(){$(this).attr("src",e)});$("tr.comment").hover(function(){$(this).find("img.comment-up, img.comment-flag, img.comment-delete").css("visibility","visible").closest("tr.comment").addClass("comment-hover")},function(){$(this).removeClass("comment-hover").find("img.comment-up, img.comment-flag, img.comment-delete").css("visibility","hidden")})};var n=function(){$("tr.comment").unbind("mouseenter mouseleave");$("img.comment-up, img.comment-flag, img.comment-delete").unbind("click mouseenter mouseleave")};var k=function(y,u,x,v,t){var w=y.parents("tr.comment").attr("id").substr("comment-".length);var s=y.attr("class");$("div.error-notification").hide();y.removeClass().unbind("click mouseenter mouseleave").attr("src",v);appendLoader(y.parent());var r=function(){y.addClass(s).click(function(){k(y,u,x,v,t)}).attr("src",x)};$.ajax({type:"POST",url:"/posts/comments/"+w+"/vote/"+u,dataType:"json",data:{fkey:fkey},success:function(z){if(z.Success){t(y,z)}else{showAjaxError(y.parent(),z.Message);r()}},error:function(z,B,A){showAjaxError(y.parent(),(z.responseText&&z.responseText.length<100?z.responseText:"An error occurred during voting"));r()}});removeLoader()};var g=function(t,s){var r=s.find("textarea");if(r.val()&&r.val().length>q){showAjaxError(s,"Comments are limited to "+q+" characters");enableSubmitButton(s);return}o(t);var u=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};$.ajax({type:"POST",url:"/posts/"+t+"/comments",dataType:"html",data:{comment:r.val(),fkey:fkey},success:function(v){u();a(t,v);r.val("");comments.updateTextCounter(r);enableSubmitButton(s)},error:function(v,x,w){removeLoader();u();showAjaxError(s,(v.responseText&&v.responseText.length<100?v.responseText:"An error occurred during comment submission"));enableSubmitButton(s)}})};return{init:function(){$("a[id^='comments-link-']").unbind("click").click(function(){var r=$(this).attr("id").substr("comments-link-".length);var u=b(r);j(r,u);u.removeClass("display-none");if($(this).text().indexOf("more comment")>-1){h(r,u)}else{var s=u.find("form textarea");var t=200+($('form[id^="form-comments-"] > table').length*2);s.attr("tabindex",t++);u.find("form input").attr("tabindex",t);s.focus()}$(this).hide()});p()},updateTextCounter:function(t,s){if(!s){s=q}var u=t.value?t.value.length:0;var r=u>s*0.8?"supernova":u>s*0.6?"hot":u>s*0.4?"warm":"cool";var v=$(t);v.parents("form").find("span.text-counter").html((s-u)+" character"+(u<s-1?"s":"")+" left").removeClass().addClass("text-counter").addClass(r)}}}();function editorReady(a){$.get("/questions/ticks",function(b){$("#post-editor-hidden").append("<input type='hidden' name='i1l' value='"+b+"' />")});if($("#show-editor-button").length==0){initPostEditor(a)}}function initPostEditor(c){var b=$("#post-form");var a=$("#wmd-input");b.submit(function(){var d=true;var e=function(f){d=f};bindLengthValidation("#title",15,"* required - at least 15 characters",$("#question-suggestions"),e);bindLengthValidation(a,15,"* required - at least 15 characters",$("#wmd-form-error").find(".form-error"),e);bindLengthValidation("#tagnames",1,"* required",null,e);bindLengthValidation("#display-name",1,"* required if you're not using an OpenID",$('label[for="display-name"] > span.form-error'),e,"#openid_identifier");bindLengthValidation("#m-address",1,"* required if you're not using an OpenID",$('label[for="m-address"] > span.form-error'),e,"#openid_identifier");if(d){disableSubmitButton(b);setConfirmUnload(null)}return d});a.not(".processed").TextAreaResizer();a.typeWatch({highlight:false,wait:5000,captureLength:5,callback:styleCode});Attacklab.wmdBase();Attacklab.Util.startEditor();if(c){a.keypress(heartbeat.start)}a.keypress(initNavPrevention)}var invalidElements=function(){var b=[];var a=function(c){return c.attr("name")};return{add:function(e){var c=a(e);var f=true;for(var d=0;d<b.length;d++){if(b[d]==c){f=false;break}}if(f){b.push(c)}},remove:function(e){var c=a(e);for(var d=0;d<b.length;d++){if(b[d]==c){b.splice(d,1)}}},any:function(){return b.length>0}}}();function bindLengthValidation(f,a,d,b,e,c){$(f).each(function(){var j=$(this);var i=j.parents("form");var h=b?$(b):j.parent().find(".form-error");var m=function(){return $.trim(j.val()).length>=a};var g=function(){h.text(d)};var n=function(){g();disableSubmitButton(i);invalidElements.add(j)};var l=function(){return(c&&$(c).val().length>0)};if(!l()&&!m()){e(false);n();if(!j.attr("hasLengthValidationEvent")){j.attr("hasLengthValidationEvent","true");var k=function(){if(!l()&&!m()){n()}else{h.text("");invalidElements.remove(j);if(!invalidElements.any()){enableSubmitButton(i)}}};j.keyup(k);if(c){$(c).keyup(k)}}}})}function initNavPrevention(a){if(a.which=="undefined"){return}var b=$("#wmd-input");b.unbind("keypress",initNavPrevention);setConfirmUnload("You have started writing or editing a post.",b)}var heartbeat=function(){var d=1000*60;var b;var e=0;var a=false;var c=0;return{start:function(f){if(f.which=="undefined"){return}if(e++>0){return}$("#wmd-input").unbind("keypress",heartbeat.start);b=location.href.match(/\/questions\/(\d+)/i)[1];setTimeout(heartbeat.ping,d)},ping:function(){var f="";$("div.answer").each(function(){f+=this.id.substring("answer-".length)+" "});$.post("/posts/"+b+"/new-activity-heartbeat",{answerIds:f},heartbeat.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.NoPosting){var h="This question has been "+g.Msg+" - no more answers will be accepted.";notify.show(h);a=true;disableSubmitButton("#post-form");setConfirmUnload(null);f=false}else{if(g.Result){var h=g.Count+" new answer"+(g.Count==1?" has":"s have")+" been posted - ";h+='<a onclick="heartbeat.update()">load new answers.</a>';notify.show(h);a=true}}}if(f){setTimeout(heartbeat.ping,d)}},update:function(){var f=[];$.get("/questions/"+b,function(i){var l=$(i);l.find("div.answer").each(function(){var m=this.id.substring("answer-".length);if($("#answer-"+m).length==0){f.push(this.id)}});if(f.length>0){var h="#"+f.join(",#");var k=l.find(h);var g=$("div.answer:last");if(g.length==0){g=$("#answers-header")}k.hide();g.after(k);k.fadeIn("slow");var j=$("div.answer").length;$("#subheader h2").text(j+" Answer"+(j>1?"s":""));vote.init(b);comments.init()}notify.close();a=false},"html")}}}();(function(a){a.fn.typeWatch=function(d){var b=a.extend({wait:750,callback:function(){},highlight:true,captureLength:2},d);function c(h,g){var f=a(h.el).val();if((f.length>b.captureLength&&f.toUpperCase()!=h.text)||(g&&f.length>b.captureLength)){h.text=f.toUpperCase();h.cb(f)}}function e(g){if(g.type.toUpperCase()=="TEXT"||g.nodeName.toUpperCase()=="TEXTAREA"){var h={timer:null,text:a(g).val().toUpperCase(),cb:b.callback,el:g,wait:b.wait};if(b.highlight){a(g).focus(function(){this.select()})}var f=function(i){var l=h.wait;var k=false;if(i.keyCode==13&&this.type.toUpperCase()=="TEXT"){l=1;k=true}var j=function(){c(h,k)};clearTimeout(h.timer);h.timer=setTimeout(j,l)};a(g).keydown(f)}}return this.each(function(f){e(this)})}})(jQuery);(function(c){var h,i;var d=0;var a=32;var e;c.fn.TextAreaResizer=function(){return this.each(function(){h=c(this).addClass("processed"),i=null;c(this).parent().append(c('<div class="grippie"></div>').bind("mousedown",{el:this},b));var k=c("div.grippie",c(this).parent())[0];k.style.marginRight=(k.offsetWidth-c(this)[0].offsetWidth)+"px"})};function b(k){h=c(k.data.el);h.blur();d=j(k).y;i=h.height()-d;h.css("opacity",0.25);c(document).mousemove(g).mouseup(f);return false}function g(m){var k=j(m).y;var l=i+k;if(d>=(k)){l-=5}d=k;l=Math.max(a,l);h.height(l+"px");if(l<a){f(m)}return false}function f(k){c(document).unbind("mousemove",g).unbind("mouseup",f);h.css("opacity",1);h.focus();h=null;i=null;d=0}function j(k){return{x:k.clientX+document.documentElement.scrollLeft,y:k.clientY+document.documentElement.scrollTop}}})(jQuery);